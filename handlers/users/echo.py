import time

from aiogram import types, bot
from aiogram.dispatcher import FSMContext
import csv
import logging

from loader import dispatcher, amplitude, bot
from data import config


logging.basicConfig(format=u'%(filename)s [LINE:%(lineno)d] #%(levelname)-8s [%(asctime)s]  %(message)s',
                    level=logging.INFO)


# –≠—Ö–æ —Ö–µ–Ω–¥–ª–µ—Ä, –∫—É–¥–∞ –ª–µ—Ç—è—Ç –í–°–ï —Å–æ–æ–±—â–µ–Ω–∏—è —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
@dispatcher.message_handler(state="*", content_types=types.ContentTypes.ANY)
async def bot_echo_all(message: types.Message, state: FSMContext):
    data = await state.get_data()
    suggest_state = data.get("suggest_state")

    if suggest_state == 1:
        await state.update_data(suggest_state=2, restaurant_name=message.text)
        await message.answer("–ö–∞–∫–∏–µ –≤–µ–≥–∞–Ω—Å–∫–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –µ—Å—Ç—å –≤ —ç—Ç–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏?")
    elif suggest_state == 2:
        await state.update_data(suggest_state=0)
        await message.answer("–ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –∑–∞–≤–µ–¥–µ–Ω–∏–µ –∏, –≤–æ–∑–º–æ–∂–Ω–æ, –¥–æ–±–∞–≤–∏–º –µ–≥–æ –≤ –Ω–∞—à—É –±–∞–∑—É. –°–ø–∞—Å–∏–±–æ!\n\n–ù–∞–º –Ω—É–∂–Ω–∞ –ø–æ–º–æ—â—å –≤ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ –±–∞–∑—ã –º–µ—Å—Ç. –ï—Å–ª–∏, –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø–æ—É—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Ä–∞–∑–≤–∏—Ç–∏–∏ Vegan Map, –Ω–∞–ø–∏—à–∏—Ç–µ @oksnavau")

        restaurant_name = data.get("restaurant_name")
        await bot.send_message(config.ADMINS[0], f'#–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ_–∑–∞–≤–µ–¥–µ–Ω–∏–µ\n<b>{data.get("restaurant_name")}</b>\n{message.text}')
        await bot.send_message(config.ADMINS[1], f'#–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ_–∑–∞–≤–µ–¥–µ–Ω–∏–µ\n<b>{data.get("restaurant_name")}</b>\n{message.text}')
    else:
        await message.answer('''
        ‚ö†Ô∏è –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–Ω–æ–ø–∫–∞ (–±—ã–≤–∞–µ—Ç —Å –∫–æ–º–ø—å—é—Ç–µ—Ä–∞):
1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–∫—Ä–µ–ø–∫—É —Å–ª–µ–≤–∞ –æ—Ç –ø–æ–ª—è –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è¬ª
3. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–µ–æ–ø–æ–∑–∏—Ü–∏—é (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –¥–æ—Å—Ç—É–ø Telegram –∫ –≥–µ–æ–ø–æ–∑–∏—Ü–∏–∏)

üß≠ –ö–∞–∫ –ø—Ä–æ–ª–æ–∂–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
1. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç—É¬ª –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º —Å –∑–∞–≤–µ–¥–µ–Ω–∏–µ–º
2. –¢–∞–ø–Ω–∏—Ç–µ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–∞—Ä—Ç–æ–π
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É ¬´–ú–∞—Ä—à—Ä—É—Ç—ã¬ª
4. –í –º–µ–Ω—é –≤—ã–±–µ—Ä–∏—Ç–µ –ª—é–±–∏–º–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–∞—Ä—Ç

üó∫ –ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏—è –≤ –¥—Ä—É–≥–æ–º —Ä–∞–π–æ–Ω–µ
1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å–∫—Ä–µ–ø–∫—É —Å–ª–µ–≤–∞ –æ—Ç –ø–æ–ª—è –≤–≤–æ–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
2. –í—ã–±–µ—Ä–∏—Ç–µ ¬´–ì–µ–æ–ø–æ–∑–∏—Ü–∏—è¬ª
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ç–æ—á–∫—É –≤ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–º –º–µ—Å—Ç–µ

üö¶ –°—Ç–∞—Ç—É—Å—ã –∑–∞–≤–µ–¥–µ–Ω–∏–π
‚Ä¢ 100% vegan: –≤—Å–µ –ø–æ–∑–∏—Ü–∏–∏ –≤ –∑–∞–≤–µ–¥–µ–Ω–∏–∏ –≤–µ–≥–∞–Ω—Å–∫–∏–µ
‚Ä¢ –ö—É—Ö–Ω—è ‚Äì 100 vegan, –ø–æ –Ω–∞–ø–∏—Ç–∫–∞–º —É—Ç–æ—á–Ω—è–π—Ç–µ: –æ—Å–æ–±—ã–π —Å—Ç–∞—Ç—É—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏—à–ª–æ—Å—å –¥–æ–±–∞–≤–∏—Ç—å –¥–ª—è –∫–∞—Ñ–µ ¬´–û–≥—É—Ä—Ü—ã¬ª –∏ ¬´VeggieBox¬ª
‚Ä¢ –ë–æ–ª—å—à–µ —Ç—Ä—ë—Ö –≤–µ–≥–∞–Ω—Å–∫–∏—Ö –ø–æ–∑–∏—Ü–∏–π: –≤ –∑–∞–≤–µ–¥–µ–Ω–∏–∏ 4 –∏ –±–æ–ª—å—à–µ –ø–æ–∑–∏—Ü–∏–π –ø–æ –≤–µ–≥–∞–Ω—É
‚Ä¢ –ï—Å–ª–∏ –±–ª—é–¥ –º–µ–Ω—å—à–µ —Ç—Ä–µ—Ö, –º—ã –ø—Ä–æ—Å—Ç–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –∏—Ö —Å–ø–∏—Å–æ–∫

‚ù§Ô∏è –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∑–∞–≤–µ–¥–µ–Ω–∏–µ ‚Äì /suggest

‚úâÔ∏è –í–æ–ø—Ä–æ—Å—ã –∏ –ø–æ–∂–µ–ª–∞–Ω–∏—è ‚Äì @startsevdev''')

    logging.info("User {} sent other content".format(message.from_user.id))
    amplitude.log(message.from_user.id, "Other")

    # –†–ê–°–°–´–õ–ö–ê
    # if message.text == "Ootro" and str(message.from_user.id) == config.ADMIN[0]:
    #     cluster = [[]]
    #     counter = 0
    #     with open('data/users.csv', newline='') as File:
    #         reader = csv.reader(File)
    #         for user_id in reader:
    #             if counter < 30:
    #                 cluster[len(cluster)-1].append(user_id[0])
    #                 counter += 1
    #             else:
    #                 counter = 0
    #                 cluster.append([])
    #     for c in cluster:
    #         for user_id in c:
    #             try:
    #                 await bot.send_message(user_id, "<b>–í–µ–≥–∞–Ω—Å–∫–∏–µ –∑–∞–≤—Ç—Ä–∞–∫–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞</b>\n\n–°–µ–≥–æ–¥–Ω—è —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª —Ñ–µ—Å—Ç–∏–≤–∞–ª—å Utroo\nhttps://t.me/utroo/1103\n\n–ò—â–∏—Ç–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è —Ñ–µ—Å—Ç–∏–≤–∞–ª—è –Ω–∞ –Ω–∞—à–µ–π –∫–∞—Ä—Ç–µ üìç\n\n–í —Ñ–µ—Å—Ç–∏–≤–∞–ª–µ —É—á–∞—Å—Ç–≤—É—é—Ç 7 –∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω—ã—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤ (¬´–ú–µ—á—Ç–∞—Ç–µ–ª–∏¬ª, Atlas bistro, Grecco, Tureckiy bistro, Merula –Ω–∞ –ù–µ–≤—Å–∫–æ–º, Bilbao –∏ ¬´–ú–æ–π–∫–∞ 3¬ª), –∞ —Ç–∞–∫–∂–µ –ø–µ—Ç–µ—Ä–±—É—Ä–≥—Å–∫–∞—è —Å–µ—Ç—å –∫–æ–Ω–¥–∏—Ç–µ—Ä—Å–∫–∏—Ö ¬´–ë—Ä–∏—Ç–∞–Ω—Å–∫–∏–µ –ø–µ–∫–∞—Ä–Ω–∏¬ª (–∞ —ç—Ç–æ 22 –∫–∞—Ñ–µ –ø–æ –≤—Å–µ–º—É –≥–æ—Ä–æ–¥—É).\n\n–ó–∞–≤—Ç—Ä–∞–∫–∏ –±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –∂–∏–≤–æ—Ç–Ω–æ–≥–æ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –ø—Ä–æ–±–æ–≤–∞—Ç—å —Ü–µ–ª—ã–π –º–µ—Å—è—Ü. –ò —Ä–µ—á—å ‚Äì –Ω–µ –æ —Å–∫—É—á–Ω—ã—Ö –∫–∞—à–∞—Ö, –Ω–æ –æ –Ω–µ–æ–±—ã—á–Ω—ã—Ö –±–ª—é–¥–∞—Ö, –≤ —á–∏—Å–ª–µ –∫–æ—Ç–æ—Ä—ã—Ö —à–æ–∫–æ–ª–∞–¥–Ω—ã–µ –ø–∞–Ω–∫–µ–π–∫–∏ —Å –∫–∞—Ä–∞–º–µ–ª—å—é –∏–∑ –∫–æ–º–±—É—á–∏, —Ç–æ–º–∞—Ç—ã —Å–æ —Å—Ç—Ä–∞—á–∞—Ç–µ–ª–ª–æ–π –∏–∑ –∫–µ—à—å—é, —Ö–∞—à–±—Ä–∞—É–Ω –∏–∑ —Ç—ã–∫–≤—ã –∏ –≤–µ–≥–∞–Ω—Å–∫–∏–π –±—Ä–∞—É–Ω–∏!")
    #                 logging.info("Sent to " + user_id)
    #             except BaseException:
    #                 print("–û—à–∏–±–∫–∞ –ø—Ä–æ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–∞—Å—Å—ã–ª–∫–∏")
    #         time.sleep(1.2)
    #     await message.answer("–†–∞—Å—Å—ã–ª–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞")
    # else:
